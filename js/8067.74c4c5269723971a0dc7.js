"use strict";(self.webpackChunksandbox=self.webpackChunksandbox||[]).push([[8067],{2489:(e,t,n)=>{n.d(t,{A:()=>X});var a=n(3345),r=n.n(a),i=n(6213),l=n(5464),s=n(9704),o=n(5450);const c=(0,a.lazy)((()=>n.e(4781).then(n.bind(n,325)))),u=(0,a.lazy)((()=>Promise.all([n.e(4510),n.e(7931),n.e(1039),n.e(7628),n.e(3459)]).then(n.bind(n,8242)))),p=(0,a.lazy)((()=>n.e(5308).then(n.bind(n,5638)))),m="true"===localStorage.getItem("dev-sandbox.experimental"),d=[{path:"no-permissions",element:u},{path:"/",element:c}];m&&d.push({path:"experimental",element:p});const v=(e=[])=>e.map((({path:e,element:t,childRoutes:n,elementProps:a})=>r().createElement(i.Route,{key:e,path:e,element:r().createElement(t,{...a})},v(n)))),g=()=>{const e=(0,a.useMemo)((()=>v(d)),[d]);return r().createElement(a.Suspense,{fallback:r().createElement(l.Bullseye,null,r().createElement(s.Spinner,null))},r().createElement(i.Routes,null,e,r().createElement(i.Route,{path:"*",element:r().createElement(i.Navigate,{replace:!0,to:o.X6})})))};var f=n(881),h=n(2404),E=n.n(h),y=n(4472),x=n(3780),b=n(2982),S=n(7178),w=n(2e3),C=n(9504),T=n(208),A=n(3168),I=n(3068),R=n(4015);const k=e=>a.createElement("div",{className:"pf-v5-u-pt-xl pf-v5-u-pt-md pf-v5-u-text-align-center"},a.createElement(b.Button,{...e,className:"pf-v5-u-w-100 pf-v5-u-w-initial-on-sm"}));var D=n(4803);const N=n.p+"fonts/launch-sandbox-success.svg";var P=n(7316),V=n(3319),q=n(3897);const B=({onClose:e,initialStatus:t})=>{const n=(0,P.j)(),{completePhoneVerification:r,getSignupData:i,initiatePhoneVerification:c,signup:u}=(0,q.A)(),[p,m]=a.useState(t&&"unknown"!==t?t:"new"),[d,v]=a.useState(),[g,f]=a.useState(""),[h,E]=a.useState(!1),[y,B]=a.useState(""),[F,G]=a.useState(""),[L,$]=a.useState(!1),[X,j]=a.useState(),U=a.useCallback((async()=>{try{const e=await i();j(e),null==e?m("new"):!0===e.status.ready?m("ready"):!1===e.status.ready&&e.status.verificationRequired?m((e=>"verify"!==e&&"verifyCode"!==e?"verify":e)):!1===e.status.ready&&"Provisioning"===e.status.reason?m("provisioning"):m("pending-approval")}catch(e){v((0,o.gJ)(e))}}),[]);return a.useEffect((()=>{if("provisioning"===p||"pending-approval"===p){const e=setInterval(U,2e3);return()=>{clearInterval(e)}}}),[p]),a.useEffect((()=>{d&&n("DevSandbox Signup Error",{error:d})}),[d]),a.useEffect((()=>{n("DevSandbox Signup Step",{step:p})}),[p]),a.createElement(C.Modal,{"data-testid":"registration-modal",width:600,"aria-labelledby":"registration-modal-title",header:a.createElement(I.Title,{id:"registration-modal-title",headingLevel:"h1"},"ready"===p?"Congratulations, you're ready to get started!":"Activate your free 30 days trial"),isOpen:!0,onClose:()=>e(X)},d?a.createElement(x.Alert,{title:"An error occurred",variant:x.AlertVariant.danger,actionClose:a.createElement(x.AlertActionCloseButton,{onClose:()=>v(void 0)}),isInline:!0,className:"pf-v5-u-mb-lg"},d):null,(()=>{switch(p){case"new":return a.createElement(k,{isDisabled:h,isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await u(),await U()}catch(e){v((0,o.gJ)(e))}finally{E(!1)}}},"Activate");case"verify":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly."),a.createElement(T.Text,{component:T.TextVariants.p},"One more thing, to ensure your account is secure please enter a valid phone number for SMS verification.")),a.createElement(S.Form,null,a.createElement(w.Grid,{hasGutter:!0,className:"pf-v5-u-mt-md",style:{alignItems:"end"}},a.createElement(w.GridItem,{span:3},a.createElement(S.FormGroup,{label:"Country code",isRequired:!0},a.createElement(A.TextInput,{"aria-label":"Country code",isRequired:!0,validated:!y||(0,D.Ef)(y)?"default":"error",type:"text",placeholder:"+01",minLength:1,maxLength:4,value:y,onChange:(e,t)=>{v(void 0),B(t)}}))),a.createElement(w.GridItem,{span:9},a.createElement(S.FormGroup,{label:"Phone number",isRequired:!0},a.createElement(A.TextInput,{"aria-label":"Phone number",isRequired:!0,validated:!F||(0,D.g0)(F)?"default":"error",type:"tel",placeholder:"123-456-7890",minLength:6,maxLength:32,value:F,onChange:(e,t)=>{v(void 0),G(t)}}))))),a.createElement(k,{isDisabled:h||!(0,D.Ef)(y)||!(0,D.g0)(F),isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await c(y,F),m("verifyCode")}catch(e){v((0,o.gJ)(e))}finally{E(!1)}}},"Next"));case"verifyCode":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly."),a.createElement(T.Text,{component:T.TextVariants.p},'We sent a verification code to "',a.createElement("b",null,`${y} ${F}`),'"')),a.createElement(S.Form,null,a.createElement(S.FormGroup,{label:"Verification code",isRequired:!0,className:"pf-v5-u-mt-md pf-v5-u-mb-md"},a.createElement(A.TextInput,{"aria-label":"Veritification code",isRequired:!0,validated:g&&6!==g.length?"error":"default",minLength:6,maxLength:6,placeholder:"XXXXXX",value:g||"",onChange:(e,t)=>{v(void 0),$(!1),f(t)}}))),a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"No text received?"," ",a.createElement(V.A,{isInline:!0,variant:b.ButtonVariant.link,onClick:()=>{v(void 0),f(""),c(y,F),$(!0)},analytics:{event:"DevSandbox Signup Resend Code"}},"Resend code"),L?a.createElement(R.CheckIcon,{className:"pf-v5-u-ml-md",style:{color:"var(--pf-v5-global--success-color--100)"}}):null,a.createElement("br",null),"Or"," ",a.createElement(b.Button,{isInline:!0,variant:b.ButtonVariant.link,onClick:()=>{v(void 0),m("verify"),f("")}},"use a different phone number"))),a.createElement(k,{isDisabled:h||6!==g.length,isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await r(g),await U()}catch(e){v((0,o.gJ)(e)||"Error while sending verification code. Please try again.")}finally{E(!1)}}},"Next"));case"provisioning":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly.")),a.createElement(l.Bullseye,{className:"pf-v5-u-mt-2xl pf-v5-u-mb-lg"},a.createElement(s.Spinner,{size:"xl"})),a.createElement(k,{isDisabled:!0},"Launch Sandbox"));case"pending-approval":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement("p",null,"Your Sandbox account is waiting for approval.")),a.createElement(l.Bullseye,{className:"pf-v5-u-mt-2xl pf-v5-u-mb-lg"},a.createElement(s.Spinner,{size:"xl"})),a.createElement(k,{onClick:()=>e(X)},"Close"));case"ready":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"Your Sandbox is now active. It will be available for next 30 days. Jump right in and start creating your applications!")),a.createElement("div",{className:"pf-v5-u-p-md"},a.createElement("img",{src:N})),a.createElement(k,{onClick:()=>e(X)},"Got it"));default:return null}})())};var F=n(9030),G=n(6718),L=n(7095);const $=({children:e})=>{a.useEffect((()=>{(0,F.F)()}),[]);const t=(0,G.Xr)(L.q),n=(0,P.j)(),{getSignupData:r}=(0,q.A)(),[i,l]=a.useState(!0),[s,c]=a.useState(),[u,p]=a.useState(),[m,d]=a.useState(!1),[v,g]=a.useState(!1),f=a.useMemo((()=>i?"unknown":(0,y.a)(s)),[i,s]);a.useEffect((()=>{i||n("DevSandbox Signup Status",{status:f})}),[i,f]);const h=a.useRef();h.current=async()=>{try{const e=await r();E()(e,s)||c(e),p(void 0),l(!1)}catch(e){p(`An error occurred retrieving registration status. ${(0,o.gJ)(e)}`),l(!1)}};const x=a.useCallback((async()=>h.current?.()),[]);a.useEffect((()=>{h.current?.()}),[]);const b=!m,S="provisioning"===f?2e3:2e4;a.useEffect((()=>{if(b){const e=setInterval((()=>{h.current?.()}),S);return()=>{clearInterval(e)}}}),[b,S]);const w=a.useMemo((()=>({setError:p,setSignupData:c,setShowUserSignup:d,refreshSignupData:x})),[x]),C=a.useMemo((()=>[{error:u,signupData:s,showUserSignup:m,status:f},w]),[u,s,m,f,w]);return a.useEffect((()=>{t(s)}),[s]),a.useEffect((()=>{"ready"===f&&v?d(!0):"ready"===f||v||i||g(!0)}),[f]),a.createElement(y.Z.Provider,{value:C},m?a.createElement(B,{initialStatus:f,onClose:e=>{n("DevSandbox Signup Closed"),e&&c(e),d(!1)}}):null,e)},X=()=>{const{updateDocumentTitle:e}=(0,f.A)();return(0,a.useEffect)((()=>{e("Developer Sandbox")}),[]),r().createElement(a.Fragment,null,r().createElement($,null,r().createElement(g,null)))}},3319:(e,t,n)=>{n.d(t,{A:()=>l});var a=n(3345),r=n(2982),i=n(7316);const l=({onClick:e,analytics:t,...n})=>{const l=(0,i.j)();return a.createElement(r.Button,{...n,onClick:t?(...n)=>{l(t.event,t.properties),e?.(...n)}:e})}},1296:(e,t,n)=>{n.d(t,{Ay:()=>c,w6:()=>a});var a,r=n(3345),i=n(881),l=n(4088),s=n.n(l);!function(e){e[e.REGISTRATION=0]="REGISTRATION",e[e.KUBE_API=1]="KUBE_API"}(a||(a={}));const o={[a.REGISTRATION]:"https://registration-service-toolchain-host-operator.apps.sandbox.x8i5.p1.openshiftapps.com",[a.KUBE_API]:"https://api-toolchain-host-operator.apps.sandbox.x8i5.p1.openshiftapps.com"},c=e=>{const{auth:t}=(0,i.A)();return r.useMemo((()=>{const n=s().create();return n.interceptors.request.use((t=>({baseURL:o[e],...t}))),n.interceptors.request.use((e=>t.getToken().then((t=>t?{...e,headers:{Accept:"application/json",Authorization:`Bearer ${t}`,...e.headers}}:e)))),n}),[t])}},3897:(e,t,n)=>{n.d(t,{A:()=>i});var a=n(4803),r=n(1296);const i=()=>{const e=(0,r.Ay)(r.w6.REGISTRATION);return{getSignupData:()=>(0,a.hn)(e),signup:()=>(0,a.$5)(e),initiatePhoneVerification:async(t,n)=>(0,a.f7)(e,t,n),completePhoneVerification:async t=>(0,a.nZ)(e,t)}}},7316:(e,t,n)=>{n.d(t,{j:()=>i});var a=n(3345),r=n(881);const i=()=>{const{analytics:e}=(0,r.A)();return a.useCallback(((t,n)=>{e?.track(t,n)}),[e])}},4803:(e,t,n)=>{n.d(t,{$5:()=>c,Ef:()=>m,f7:()=>u,g0:()=>d,hn:()=>o,nZ:()=>p});var a=n(4088),r=n.n(a),i=n(9030);const l="/api/v1/signup",s="/api/v1/signup/verification",o=async e=>{try{const{data:t}=await e.get(l);return t}catch(e){if(r().isAxiosError(e)&&404===e.response?.status)return;throw e}},c=async e=>{const t=await(async()=>new Promise(((e,t)=>{const n=i.T;let a=!1;const r=setTimeout((()=>{a=!0,t("Recaptcha timeout.")}),1e4);grecaptcha?.enterprise?grecaptcha.enterprise.ready((async()=>{if(!a){clearTimeout(r);try{e(await grecaptcha.enterprise.execute(n,{action:"SIGNUP"}))}catch(e){t("Recaptcha failure.")}}})):t("Recaptcha failure.")})))();await e.post(l,null,{headers:{"Recaptcha-Token":t}})},u=async(e,t,n)=>{if(!m(t))throw"Invalid country code.";if(!d(n))throw"Invalid phone number.";await e.put(s,{country_code:t,phone_number:n})},p=async(e,t)=>{await e.get(`${s}/${t}`)},m=e=>/^[+]?[0-9]+$/.test(e),d=e=>/^[(]?[0-9]+[)]?[-\s.]?[0-9]+[-\s./0-9]*$/im.test(e)},7095:(e,t,n)=>{n.d(t,{q:()=>a});const a=(0,n(1850).eU)(void 0)},9030:(e,t,n)=>{n.d(t,{F:()=>r,T:()=>a});const a="6Lc_164lAAAAAPvrC0WO-XDljvZ2DZ3UQ38A4XR0",r=()=>{if(a){const e=`https://www.google.com/recaptcha/enterprise.js?render=${a}`;if(!document.querySelector(`script[src="${e}"]`)){const t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.defer=!0,document.head.appendChild(t)}}}},4472:(e,t,n)=>{n.d(t,{Z:()=>a,a:()=>r});const a=n(3345).createContext(null),r=e=>{let t;return t=null==e?"new":!0===e.status.ready?"ready":!1===e.status.ready&&e.status.verificationRequired?"verify":!1===e.status.ready&&"Provisioning"===e.status.reason?"provisioning":"pending-approval",t}},5450:(e,t,n)=>{n.d(t,{X6:()=>i,gJ:()=>l});var a=n(4088),r=n.n(a);const i="/openshift/sandbox",l=e=>(r().isAxiosError(e)?e.response?.data?.message||e.message:"object"==typeof e?e?.toString():"string"==typeof e?e:"")||""}}]);