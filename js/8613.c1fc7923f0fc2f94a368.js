"use strict";(self.webpackChunksandbox=self.webpackChunksandbox||[]).push([[8613],{2089:(e,t,n)=>{n.d(t,{Z:()=>q});var a=n(8416),r=n.n(a),i=n(8947),l=n(8087),s=n(2693),o=n(9090);const c=(0,a.lazy)((()=>n.e(7945).then(n.bind(n,3803)))),u=(0,a.lazy)((()=>Promise.all([n.e(7794),n.e(164),n.e(7955),n.e(1051),n.e(9452)]).then(n.bind(n,8685)))),p=(0,a.lazy)((()=>n.e(2869).then(n.bind(n,8780)))),m="true"===localStorage.getItem("dev-sandbox.experimental"),d=[{path:"no-permissions",element:u},{path:"/",element:c}];m&&d.push({path:"experimental",element:p});const v=(e=[])=>e.map((({path:e,element:t,childRoutes:n,elementProps:a})=>r().createElement(i.Route,{key:e,path:e,element:r().createElement(t,{...a})},v(n)))),f=()=>{const e=(0,a.useMemo)((()=>v(d)),[d]);return r().createElement(a.Suspense,{fallback:r().createElement(l.Bullseye,null,r().createElement(s.Spinner,null))},r().createElement(i.Routes,null,e,r().createElement(i.Route,{path:"*",element:r().createElement(i.Navigate,{replace:!0,to:o.dF})})))};var g=n(5140),h=n(8446),E=n.n(h),y=n(6419),x=n(4440),b=n(1454),S=n(2092),C=n(3721),w=n(1925),T=n(4129),I=n(9389),R=n(8956),k=n(2247);const A=e=>a.createElement("div",{className:"pf-u-pt-xl pf-u-pt-md pf-u-text-align-center"},a.createElement(b.Button,{...e,className:"pf-u-w-100 pf-u-w-initial-on-sm"}));var N=n(7452);const P=n.p+"fonts/launch-sandbox-success.svg";var D=n(3072),G=n(7758),V=n(875);const B=({onClose:e,initialStatus:t})=>{const n=(0,D.K)(),{completePhoneVerification:r,getSignupData:i,initiatePhoneVerification:c,signup:u}=(0,V.Z)(),[p,m]=a.useState(t&&"unknown"!==t?t:"new"),[d,v]=a.useState(),[f,g]=a.useState(""),[h,E]=a.useState(!1),[y,B]=a.useState(""),[F,L]=a.useState(""),[Z,$]=a.useState(!1),[q,U]=a.useState(),X=a.useCallback((async()=>{try{const e=await i();U(e),null==e?m("new"):!0===e.status.ready?m("ready"):!1===e.status.ready&&e.status.verificationRequired?m((e=>"verify"!==e&&"verifyCode"!==e?"verify":e)):!1===e.status.ready&&"Provisioning"===e.status.reason?m("provisioning"):m("pending-approval")}catch(e){v((0,o.N3)(e))}}),[]);return a.useEffect((()=>{if("provisioning"===p||"pending-approval"===p){const e=setInterval(X,2e3);return()=>{clearInterval(e)}}}),[p]),a.useEffect((()=>{d&&n("DevSandbox Signup Error",{error:d})}),[d]),a.useEffect((()=>{n("DevSandbox Signup Step",{step:p})}),[p]),a.createElement(w.Modal,{"data-testid":"registration-modal",width:600,"aria-labelledby":"registration-modal-title",header:a.createElement(R.Title,{id:"registration-modal-title",headingLevel:"h1"},"ready"===p?"Congratulations, you're ready to get started!":"Activate your free 30 days trial"),isOpen:!0,onClose:()=>e(q)},d?a.createElement(x.Alert,{title:"An error occurred",variant:x.AlertVariant.danger,actionClose:a.createElement(x.AlertActionCloseButton,{onClose:()=>v(void 0)}),isInline:!0,className:"pf-u-mb-lg"},d):null,(()=>{switch(p){case"new":return a.createElement(A,{isDisabled:h,isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await u(),await X()}catch(e){v((0,o.N3)(e))}finally{E(!1)}}},"Activate");case"verify":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly."),a.createElement(T.Text,{component:T.TextVariants.p},"One more thing, to ensure your account is secure please enter a valid phone number for SMS verification.")),a.createElement(S.Form,null,a.createElement(C.Grid,{hasGutter:!0,className:"pf-u-mt-md",style:{alignItems:"end"}},a.createElement(C.GridItem,{span:3},a.createElement(S.FormGroup,{label:"Country code",isRequired:!0},a.createElement(I.TextInput,{"aria-label":"Country code",isRequired:!0,validated:!y||(0,N.GC)(y)?"default":"error",type:"text",placeholder:"+01",minLength:1,maxLength:4,value:y,onChange:(e,t)=>{v(void 0),B(t)}}))),a.createElement(C.GridItem,{span:9},a.createElement(S.FormGroup,{label:"Phone number",isRequired:!0},a.createElement(I.TextInput,{"aria-label":"Phone number",isRequired:!0,validated:!F||(0,N.yf)(F)?"default":"error",type:"tel",placeholder:"123-456-7890",minLength:6,maxLength:32,value:F,onChange:(e,t)=>{v(void 0),L(t)}}))))),a.createElement(A,{isDisabled:h||!(0,N.GC)(y)||!(0,N.yf)(F),isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await c(y,F),m("verifyCode")}catch(e){v((0,o.N3)(e))}finally{E(!1)}}},"Next"));case"verifyCode":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly."),a.createElement(T.Text,{component:T.TextVariants.p},'We sent a verification code to "',a.createElement("b",null,`${y} ${F}`),'"')),a.createElement(S.Form,null,a.createElement(S.FormGroup,{label:"Verification code",isRequired:!0,className:"pf-u-mt-md pf-u-mb-md"},a.createElement(I.TextInput,{"aria-label":"Veritification code",isRequired:!0,validated:f&&6!==f.length?"error":"default",minLength:6,maxLength:6,placeholder:"XXXXXX",value:f||"",onChange:(e,t)=>{v(void 0),$(!1),g(t)}}))),a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"No text received?"," ",a.createElement(G.Z,{isInline:!0,variant:b.ButtonVariant.link,onClick:()=>{v(void 0),g(""),c(y,F),$(!0)},analytics:{event:"DevSandbox Signup Resend Code"}},"Resend code"),Z?a.createElement(k.CheckIcon,{className:"pf-u-ml-md",style:{color:"var(--pf-global--success-color--100)"}}):null,a.createElement("br",null),"Or"," ",a.createElement(b.Button,{isInline:!0,variant:b.ButtonVariant.link,onClick:()=>{v(void 0),m("verify"),g("")}},"use a different phone number"))),a.createElement(A,{isDisabled:h||6!==f.length,isLoading:h,onClick:async()=>{try{v(void 0),E(!0),await r(f),await X()}catch(e){v((0,o.N3)(e)||"Error while sending verification code. Please try again.")}finally{E(!1)}}},"Next"));case"provisioning":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"We are preparing your Sandbox. It will be available shortly.")),a.createElement(l.Bullseye,{className:"pf-u-mt-2xl pf-u-mb-lg"},a.createElement(s.Spinner,{size:"xl"})),a.createElement(A,{isDisabled:!0},"Launch Sandbox"));case"pending-approval":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement("p",null,"Your Sandbox account is waiting for approval.")),a.createElement(l.Bullseye,{className:"pf-u-mt-2xl pf-u-mb-lg"},a.createElement(s.Spinner,{size:"xl"})),a.createElement(A,{onClick:()=>e(q)},"Close"));case"ready":return a.createElement(a.Fragment,null,a.createElement(T.TextContent,null,a.createElement(T.Text,{component:T.TextVariants.p},"Your Sandbox is now active. It will be available for next 30 days. Jump right in and start creating your applications!")),a.createElement("div",{className:"pf-u-p-md"},a.createElement("img",{src:P})),a.createElement(A,{onClick:()=>e(q)},"Got it"));default:return null}})())};var F=n(652),L=n(8483),Z=n(7629);const $=({children:e})=>{a.useEffect((()=>{(0,F.H)()}),[]);const t=(0,L.b9)(Z.T),n=(0,D.K)(),{getSignupData:r}=(0,V.Z)(),[i,l]=a.useState(!0),[s,c]=a.useState(),[u,p]=a.useState(),[m,d]=a.useState(!1),[v,f]=a.useState(!1),g=a.useMemo((()=>i?"unknown":(0,y.M)(s)),[i,s]);a.useEffect((()=>{i||n("DevSandbox Signup Status",{status:g})}),[i,g]);const h=a.useRef();h.current=async()=>{try{const e=await r();E()(e,s)||c(e),p(void 0),l(!1)}catch(e){p(`An error occurred retrieving registration status. ${(0,o.N3)(e)}`),l(!1)}};const x=a.useCallback((async()=>h.current?.()),[]);a.useEffect((()=>{h.current?.()}),[]);const b=!m,S="provisioning"===g?2e3:2e4;a.useEffect((()=>{if(b){const e=setInterval((()=>{h.current?.()}),S);return()=>{clearInterval(e)}}}),[b,S]);const C=a.useMemo((()=>({setError:p,setSignupData:c,setShowUserSignup:d,refreshSignupData:x})),[x]),w=a.useMemo((()=>[{error:u,signupData:s,showUserSignup:m,status:g},C]),[u,s,m,g,C]);return a.useEffect((()=>{t(s)}),[s]),a.useEffect((()=>{"ready"===g&&v?d(!0):"ready"===g||v||i||f(!0)}),[g]),a.createElement(y.u.Provider,{value:w},m?a.createElement(B,{initialStatus:g,onClose:e=>{n("DevSandbox Signup Closed"),e&&c(e),d(!1)}}):null,e)},q=()=>{const{updateDocumentTitle:e}=(0,g.Z)();return(0,a.useEffect)((()=>{e("Developer Sandbox")}),[]),r().createElement(a.Fragment,null,r().createElement($,null,r().createElement(f,null)))}},7758:(e,t,n)=>{n.d(t,{Z:()=>l});var a=n(8416),r=n(1454),i=n(3072);const l=({onClick:e,analytics:t,...n})=>{const l=(0,i.K)();return a.createElement(r.Button,{...n,onClick:t?(...n)=>{l(t.event,t.properties),e?.(...n)}:e})}},8379:(e,t,n)=>{n.d(t,{ZP:()=>c,xc:()=>a});var a,r=n(8416),i=n(5140),l=n(5564),s=n.n(l);!function(e){e[e.REGISTRATION=0]="REGISTRATION",e[e.KUBE_API=1]="KUBE_API"}(a||(a={}));const o={[a.REGISTRATION]:"https://registration-service-toolchain-host-operator.apps.sandbox.x8i5.p1.openshiftapps.com",[a.KUBE_API]:"https://api-toolchain-host-operator.apps.sandbox.x8i5.p1.openshiftapps.com"},c=e=>{const{auth:t}=(0,i.Z)();return r.useMemo((()=>{const n=s().create();return n.interceptors.request.use((t=>({baseURL:o[e],...t}))),n.interceptors.request.use((e=>t.getToken().then((t=>t?{...e,headers:{Accept:"application/json",Authorization:`Bearer ${t}`,...e.headers}}:e)))),n}),[t])}},875:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7452),r=n(8379);const i=()=>{const e=(0,r.ZP)(r.xc.REGISTRATION);return{getSignupData:()=>(0,a.X8)(e),signup:()=>(0,a.IU)(e),initiatePhoneVerification:async(t,n)=>(0,a.E$)(e,t,n),completePhoneVerification:async t=>(0,a.G1)(e,t)}}},3072:(e,t,n)=>{n.d(t,{K:()=>i});var a=n(8416),r=n(5140);const i=()=>{const{analytics:e}=(0,r.Z)();return a.useCallback(((t,n)=>{e?.track(t,n)}),[e])}},7452:(e,t,n)=>{n.d(t,{E$:()=>u,G1:()=>p,GC:()=>m,IU:()=>c,X8:()=>o,yf:()=>d});var a=n(5564),r=n.n(a),i=n(652);const l="/api/v1/signup",s="/api/v1/signup/verification",o=async e=>{try{const{data:t}=await e.get(l);return t}catch(e){if(r().isAxiosError(e)&&404===e.response?.status)return;throw e}},c=async e=>{const t=await(async()=>new Promise(((e,t)=>{const n=i.r;let a=!1;const r=setTimeout((()=>{a=!0,t("Recaptcha timeout.")}),1e4);grecaptcha?.enterprise?grecaptcha.enterprise.ready((async()=>{if(!a){clearTimeout(r);try{e(await grecaptcha.enterprise.execute(n,{action:"SIGNUP"}))}catch(e){t("Recaptcha failure.")}}})):t("Recaptcha failure.")})))();await e.post(l,null,{headers:{"Recaptcha-Token":t}})},u=async(e,t,n)=>{if(!m(t))throw"Invalid country code.";if(!d(n))throw"Invalid phone number.";await e.put(s,{country_code:t,phone_number:n})},p=async(e,t)=>{await e.get(`${s}/${t}`)},m=e=>/^[+]?[0-9]+$/.test(e),d=e=>/^[(]?[0-9]+[)]?[-\s.]?[0-9]+[-\s./0-9]*$/im.test(e)},7629:(e,t,n)=>{n.d(t,{T:()=>a});const a=(0,n(9726).cn)(void 0)},652:(e,t,n)=>{n.d(t,{H:()=>r,r:()=>a});const a="6Lc_164lAAAAAPvrC0WO-XDljvZ2DZ3UQ38A4XR0",r=()=>{if(a){const e=`https://www.google.com/recaptcha/enterprise.js?render=${a}`;if(!document.querySelector(`script[src="${e}"]`)){const t=document.createElement("script");t.type="text/javascript",t.src=e,t.async=!0,t.defer=!0,document.head.appendChild(t)}}}},6419:(e,t,n)=>{n.d(t,{M:()=>r,u:()=>a});const a=n(8416).createContext(null),r=e=>{let t;return t=null==e?"new":!0===e.status.ready?"ready":!1===e.status.ready&&e.status.verificationRequired?"verify":!1===e.status.ready&&"Provisioning"===e.status.reason?"provisioning":"pending-approval",t}},9090:(e,t,n)=>{n.d(t,{N3:()=>l,dF:()=>i});var a=n(5564),r=n.n(a);const i="/openshift/sandbox",l=e=>(r().isAxiosError(e)?e.response?.data?.message||e.message:"object"==typeof e?e?.toString():"string"==typeof e?e:"")||""}}]);
//# sourceMappingURL=../sourcemaps/8613.300cfeb3c87dd5fa95bc7770e191e49e.js.map